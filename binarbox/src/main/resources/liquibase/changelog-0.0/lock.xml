<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<changeSet id="lock-0" author="tnalex">
		<createTable tableName="lock_type">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"
					primaryKeyName="PK_LOCK_TYPE" />
			</column>
			<column name="lock_type" type="nvarchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="price" type="decimal">
				<constraints nullable="false" />
			</column>
			<column name="total_rating" type="float" />
		</createTable>

		<createTable tableName="lock_section">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"
					primaryKeyName="PK_LOCK_TYPE" />
			</column>
			<column name="section" type="nvarchar(100)">
				<constraints nullable="false" />
			</column>
		</createTable>

		<createTable tableName="lock_entity">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"
					primaryKeyName="PK_LOCK" />
			</column>
			<column name="longitude" type="double" />
			<column name="latitude" type="double" />
			<column name="message" type="nvarchar(100)" />
			<column name="font_size" type="int" />
			<column name="font_style" type="nvarchar(100)" />
			<column name="font_color" type="nvarchar(100)" />
			<column name="paid" type="boolean" />
			<column name="lock_section_id" type="bigint">
				<constraints nullable="true"
					referencedTableName="lock_section" referencedColumnNames="id"
					foreignKeyName="FK_LOCK_LOCK_SECTION" />
			</column>
			<column name="lock_type_id" type="bigint">
				<constraints nullable="false"
					referencedTableName="lock_type" referencedColumnNames="id"
					foreignKeyName="FK_LOCK_LOCK_TYPE" />
			</column>
			<column name="user_id" type="bigint">
				<constraints nullable="false" referencedTableName="user"
					referencedColumnNames="id" foreignKeyName="FK_LOCK_USER" />
			</column>
			<column name="delete_token" type="nvarchar(50)"></column>
			<column name="created_date" type="date">
				<constraints nullable="false" />
			</column>
			<column name="last_modified_date" type="timestamp">
				<constraints nullable="false" />
			</column>
		</createTable>

		<createTable tableName="file">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"
					primaryKeyName="PK_FILE" />
			</column>
			<column name="file_name" type="nvarchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="path_to_file" type="nvarchar(100)">
				<constraints nullable="false" />
			</column>
			<column name="lock_type_id" type="bigint">
				<constraints nullable="false"
					referencedTableName="lock_type" referencedColumnNames="id"
					foreignKeyName="FK_FILE_LOCK_TYPE" />
			</column>
			<column name="created_date" type="date">
				<constraints nullable="false" />
			</column>
			<column name="last_modified_date" type="timestamp">
				<constraints nullable="false" />
			</column>
		</createTable>

		<insert tableName="lock_section">
			<column name="section" value="a1" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="a2" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="b1" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="b2" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="c1" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="c2" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="d1" type="nvarchar(100)" />
		</insert>
		<insert tableName="lock_section">
			<column name="section" value="d2" type="nvarchar(100)" />
		</insert>
		<insert tableName="authority">
			<column name="name" value="ADMIN" type="nvarchar(100)" />
		</insert>
		<sqlFile path="classpath:/liquibase/lockTypes.sql" />
	</changeSet>

	<changeSet id="panel-0" author="tnalex">
		<createTable tableName="panel_entity">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"
					primaryKeyName="PK_PANEL_ENTITY" />
			</column>
			<column name="created_date" type="date">
				<constraints nullable="false" />
			</column>
			<column name="last_modified_date" type="timestamp">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addColumn tableName="lock_entity">
			<column name="panel_id" type="bigint">
				<constraints nullable="false"
					foreignKeyName="FK_LOCK_ENTITY_PANEL"
					referencedTableName="panel_entity" referencedColumnNames="id" />
			</column>
		</addColumn>
		<sqlFile endDelimiter="#"
			path="classpath:/liquibase/panelProcedure.sql" />
		<sql>CALL insertRandomPanelsEntity(30);</sql>
	</changeSet>

</databaseChangeLog>